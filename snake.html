<!DOCTYPE html>
<html>
<head>
<link href='http://fonts.googleapis.com/css?family=Press+Start+2P' rel='stylesheet' type='text/css'>
<style>	
body {
	font-family: 'Press Start 2P', cursive;
	padding: 0; 
	margin: 0; 
	overflow: hidden;
	width: 100%;
}

#menu {
	color: white;
	font-size: 40px;
	position: absolute;
	top: 100px; right: 0; left: 0;
	text-align: center;
	z-index: -1;
}

</style>
</head>
<body>
	<canvas id='mycanvas'></canvas>
	<div id='menu'>
		<p id='scoreboard'></p>
		<p id='start'>Start</p>
	</div>
<script>
'use strict'
function Snake(options) {
	var defaults = {
		canvasColor: 'black',
		rectSize: 15,
		snakeColor: 'white',
		speed: 40,
		startLength: 10,
	};

	this.canvas = document.getElementById('mycanvas');
	this.menu = document.getElementById('menu');
	this.scoreboard = document.getElementById('scoreboard');
	this.start = document.getElementById('start');

	this.ctx = this.canvas.getContext('2d');
	this.snake = [];
	this.food = {};
	this.options = options || defaults;
	this.dir = this.options.dir || defaults.dir;
	this.score = 0;

	window.addEventListener('load', this, false);
}

Snake.fn = Snake.prototype;

Snake.fn.handleEvent = function() {
	this.init();
}

Snake.fn.init = function() {
	this.initCanvas();
	this.initSnake();
	this.paintSnake();
	this.initFood();
	this.paintFood();
	this.initLoop();
}

Snake.fn.h = function() {
	return window.innerHeight;
}

Snake.fn.w = function() {
	return window.innerWidth;
}

Snake.fn.initCanvas = function() {
	this.canvas.height = this.h();
	this.canvas.width = this.w();
	this.ctx.fillStyle = this.options.canvasColor;
	this.ctx.fillRect(0, 0, this.w(), this.h());
}

Snake.fn.initSnake = function() {
	var len = this.options.startLength;
	var s = this.snake = [];
	var i = len - 1
	for (; i >= 0; i--) {
		s.push({x: i, y: 0});
	}
}

Snake.fn.paintSnake = function() {
	var size = this.options.rectSize;
	var s = this.snake;
	var len = this.snake.length;
	var i = 0

	for (; i < len; i++) {
		this.ctx.fillStyle = this.options.snakeColor;	
		this.ctx.fillRect(s[i].x * size, s[i].y * size, size, size);
	}
}

Snake.fn.initFood = function() {
	this.food = {
		x: Math.round(Math.random() * (this.w() - this.options.rectSize) / this.options.rectSize),
		y: Math.round(Math.random() * (this.h() - this.options.rectSize) / this.options.rectSize)
	};
}

Snake.fn.paintFood = function() {
	var size = this.options.rectSize;
	this.ctx.fillStyle = 'white';
	this.ctx.fillRect(this.food.x * size, this.food.y * size, size, size);
}

Snake.fn.repaintSnake = function() {
	var s = this.snake;
	var o = this.options;
	var f = this.food;
	var size = this.options.rectSize;
	var ctx = this.ctx;
	var headX = s[0].x;
	var headY = s[0].y;
	var _this = this;

	document.onkeydown = function(e) {
		var key = e.keyCode;

		if (key === 37 || key === 38 || key === 39 || key === 40) {
			e.preventDefault();
		}

		if(key === 37 && _this.dir !== "right") {
        	setTimeout(function() {
            	_this.dir = "left"; 
        	}, o.speed);
      	} else if(key === 38 && _this.dir !== "down") {
        	setTimeout(function() {
            	_this.dir = "up"; 
        	}, o.speed)
      	} else if(key === 39 && _this.dir !== "left") {
        	setTimeout(function() {
            	_this.dir = "right"; 
        	}, o.speed)
      	} else if(key === 40 && _this.dir !== "up") {
        	setTimeout(function() {
            	_this.dir = "down"; 
        	}, o.speed)
      	}
	}

	switch (this.dir) {
		case 'right':
			headX++;
			break;
		case 'left':
			headX--;
			break;
		case 'up':
			headY--;
			break;
		case 'down':
			headY++;
			break;
	}

	// erase tail
	ctx.fillStyle = o.canvasColor;
	ctx.fillRect(s[s.length - 1].x * size, s[s.length - 1].y * size, size, size);

	var tail = s.pop();
    tail.x = headX;
    tail.y = headY;
    s.unshift(tail);

    // add tail to head
	ctx.fillStyle = o.snakeColor;
    ctx.fillRect(s[0].x * size, s[0].y * size, size, size);

    // self collision
    var j = 1
    for (; j < s.length; j++) {
    	if (headX === s[j].x && headY === s[j].y) {
    		this.gameOver();
        } 
    } 

    // food collision;
    if (headX === f.x && headY === f.y) {
        var tail = {x: headX, y: headY};

        this.initFood();
        this.paintFood();
      	s.unshift(tail);
      	this.score++; 
    }

    // wall collision
    if (headX >= this.w() / o.rectSize || headX <= -1 || headY >= this.h() / o.rectSize || headY <= -1) {
    	this.gameOver();
    }
}

Snake.fn.initLoop = function() {
	var _this = this;
	this.dir = 'right';
	this.score = 0;
	this.menu.style.zIndex = -1;
	clearInterval(this.loop)
	this.loop = setInterval(function() {
		_this.repaintSnake();
	}, _this.options.speed);
}

Snake.fn.reset = function() {
	var _this = this;

	this.start.addEventListener('click', function() {
		_this.initCanvas();
		_this.initSnake();
		_this.paintSnake();
		_this.paintFood();
		_this.initLoop();
	}, false);

}

Snake.fn.gameOver = function() {
	clearInterval(this.loop);
	this.scoreboard.innerHTML = this.score;
	this.menu.style.zIndex = 999;
	this.reset();
}

var snake = new Snake();



</script>
</body>
</html>






















