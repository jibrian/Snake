<!DOCTYPE html>
<html>
<head>
<style>	
body {padding: 0; margin: 0; overflow: hidden;}


</style>
</head>
<body>
	<canvas id='mycanvas'></canvas>
<script>
'use strict'

function Snake(canvas, options) {
	var defaults = {
		canvasColor: 'black',
		snakeColor: 'white',
		startLength: 10,
		rectSize: 15,
		speed: 40,
		dir: 'right',
	};

	this.canvas = document.getElementById(canvas);
	this.ctx = this.canvas.getContext('2d');
	this.snake = [];
	this.food = {};
	this.options = options || defaults;
	this.dir = this.options.dir || defaults.dir;
	this.points = 0;

	window.addEventListener('load', this, false);
}

Snake.fn = Snake.prototype;

Snake.fn.handleEvent = function() {
	this.init();
}

Snake.fn.init = function() {
	this.initCanvas();
	this.initSnake();
	this.paintSnake();
	this.initFood();
	this.paintFood();
}

Snake.fn.h = function() {
	return window.innerHeight;
}

Snake.fn.w = function() {
	return window.innerWidth;
}

Snake.fn.initCanvas = function() {
	this.canvas.height = this.h();
	this.canvas.width = this.w();
	this.ctx.fillStyle = this.options.canvasColor;
	this.ctx.fillRect(0, 0, this.w(), this.h());
}

Snake.fn.initSnake = function() {
	var len = this.options.startLength;
	var s = this.snake;
	for (var i = len - 1; i >= 0; i--) {
		s.push({x: i, y: 0});
	}
}

Snake.fn.initFood = function() {
	this.food = {
		x: Math.round(Math.random() * (this.w() - this.options.rectSize) / this.options.rectSize),
		y: Math.round(Math.random() * (this.h() - this.options.rectSize) / this.options.rectSize)
	};
}

Snake.fn.paintSnake = function() {
	var size = this.options.rectSize;
	var s = this.snake;

	for (var i = 0; i < this.snake.length; i++) {
		this.ctx.fillStyle = this.options.snakeColor;	
		this.ctx.fillRect(s[i].x * size, s[i].y * size, size, size);
	}
}

Snake.fn.paintFood = function() {
	var size = this.options.rectSize;
	this.ctx.fillStyle = 'white';
	this.ctx.fillRect(this.food.x * size, this.food.y * size, size, size);
}

Snake.fn.repaintSnake = function() {
	var s = this.snake;
	var headX = s[0].x;
	var headY = s[0].y;
	var o = this.options;
	var size = this.options.rectSize;
	var ctx = this.ctx;
	var _this = this;

	document.onkeydown = function(e) {
		var key = e.keyCode;

		if (key === 37 || key === 38 || key === 39 || key === 40) {
			e.preventDefault();
		}

		if(key === 37 && _this.dir !== "right") {
        	setTimeout(function() {
            	_this.dir = "left"; 
        	}, o.speed);
      	} else if(key === 38 && _this.dir !== "down") {
        	setTimeout(function() {
            	_this.dir = "up"; 
        	}, o.speed)
      	} else if(key === 39 && _this.dir !== "left") {
        	setTimeout(function() {
            	_this.dir = "right"; 
        	}, o.speed)
      	} else if(key === 40 && _this.dir !== "up") {
        	setTimeout(function() {
            	_this.dir = "down"; 
        	}, o.speed)
      	}
	}

	switch (this.dir) {
		case 'right':
			headX++;
			break;
		case 'left':
			headX--;
			break;
		case 'up':
			headY--;
			break;
		case 'down':
			headY++;
			break;
	}

	// erase tail
	ctx.fillStyle = o.canvasColor;
	ctx.fillRect(s[s.length - 1 ].x * size, s[s.length - 1].y * size, size, size);

	var tail = s.pop();
    tail.x = headX;
    tail.y = headY;
    s.unshift(tail);

    // add tail to head
	ctx.fillStyle = o.snakeColor;
    ctx.fillRect(s[0].x * size, s[0].y * size, size, size);

    var f = this.food;

    // self collision
    for (var j = 1; j < s.length; j++) {
    	if (headX === s[j].x && headY === s[j].y) {
    		this.gameOver();
        }
    } 

    // food collision;
    if (headX === f.x && headY === f.y) {
        var tail = {x: headX, y: headY};

        this.initFood();
      	s.unshift(tail);
      	this.points++; 
      	if (this.o.speed >= 20) {
      		this.options.speed--; 
      	}
    }

    if (headX >= this.w() / o.rectSize || headX <= -1 || headY >= this.h() / o.rectSize || headY <= -1) {
    	this.gameOver();
    }
}

Snake.fn.paint = function() {
	this.repaintSnake();
	this.paintFood();
}

Snake.fn.gameOver = function() {
	clearInterval(start);
}


var snake = new Snake('mycanvas');

var start = setInterval(function() {
	snake.paint();
}, snake.options.speed);





</script>
</body>
</html>






















